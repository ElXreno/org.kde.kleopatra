id: org.kde.kleopatra
runtime: org.kde.Platform
runtime-version: "5.14"
sdk: org.kde.Sdk
command: kleopatra
finish-args:
  - --device=dri
  - --filesystem=host
  - --share=ipc
  - --share=network
  - --socket=ssh-auth
  - --socket=x11
  - --talk-name=org.kde.StatusNotifierWatcher
  - --own-name=org.kde.StatusNotifierItem-2-1
  - --own-name=local.kleopatra
rename-icon: kleopatra
cleanup:
  - /include
  - /lib/cmake
  - /mkspecs
modules:
  - name: kleopatra
    buildsystem: cmake-ninja
    sources:
      - type: archive
        url: https://download.kde.org/stable/release-service/20.04.2/src/kleopatra-20.04.2.tar.xz
        sha256: b5adbae9de6e40570b5dc0d4a9a74ce10f1fac6dea25cc5287c62fbae5fe2cd8
      
      - type: patch
        path: patches/kleopatra-fix-appdata.xml
    modules:
      - name: boost
        buildsystem: simple
        build-commands:
          - ./bootstrap.sh --prefix=/app
          - ./b2 -j $FLATPAK_BUILDER_N_JOBS
          - ./b2 install
        cleanup:
          - /lib/libboost_*.a
        sources:
          - type: archive
            url: https://downloads.sourceforge.net/project/boost/boost/1.73.0/boost_1_73_0.tar.bz2
            sha256: 4eb3b8d442b426dc35346235c8733b5ae35ba431690e38c6a8263dce9fcbb402

      - name: gpgme
        sources:
          - type: archive
            url: https://www.gnupg.org/ftp/gcrypt/gpgme/gpgme-1.13.1.tar.bz2
            sha256: c4e30b227682374c23cddc7fdb9324a99694d907e79242a25a4deeedb393be46
      
      - name: libkleo
        buildsystem: cmake-ninja
        sources:
          - type: archive
            url: https://download.kde.org/stable/release-service/20.04.2/src/libkleo-20.04.2.tar.xz
            sha256: 0b343fc6bae604e596ff36d47d28aac7c85a72c4461cd5c80682eae27d109eef
      
      - name: kmime
        buildsystem: cmake-ninja
        sources:
          - type: archive
            url: https://download.kde.org/stable/release-service/20.04.2/src/kmime-20.04.2.tar.xz
            sha256: 5ac4c9fe779b2652c2afb07b5771fd3c498599dec2d5cbc66756106a05cca9c5